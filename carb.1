.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3 (edited to reflect current features).
.TH CARB "1" "November 2025" "carb 1.0 (2025-10-29)" "User Commands"
.SH NAME
carb \- manual page for carb 1.0 (2025-10-29)
.SH DESCRIPTION
carb \-\- Content\-addressable robust backup and per\-file ingester with PAR2.
.PP
Scans a start directory, ingests every regular file, and stores its bytes once
under a content\-addressable blob name "\fI<padded_size>\fR_\fI<sha256>\fR.data".
Subsequent duplicates hardlink to the same blob. Each run writes a metadata
snapshot and a self\-contained \fBrecover.sh\fR that can verify/repair bytes with
PAR2 and restore original paths relative to the snapshot root.
.SS "Usage:"
.IP
\fBcarb\fR \fI<START_DIR>\fR [\fIREFERENCE_FILE\fR | \fB\-\-full\fR]
.SS "Modes:"
.TP
Incremental
backup only files newer than \fIREFERENCE_FILE\fR
.TP
Full backup
backup all files under \fISTART_DIR\fR
.SS "Output layout (under \fBCARB_HOME\fR):"
.IP
\fBblobs_sha256/\fR          content\-addressed data blobs; \fBINDEX.txt\fR appends seen names
.br
\fBblobs_par2/\fR            parity sets (\fB.par2\fR + \fB.vol*.par2\fR) per blob
.br
\fBblobs_tmp/\fR             temporary workspace
.br
\fBblobs_meta/\fR            per\-run metadata snapshots
.br
\fBblobs_meta/v05_\fRYYYY\-MM\-DD_HH_MM_SS/
.br
\-\ \fBfile_processed.txt\fR   blobname:cwd:startdir:absolute_path (all seen)
.br
\-\ \fBfile_skipped.txt\fR     lines for files deduped by existing blob
.br
\-\ \fBfile_ingested.txt\fR    lines for files that produced/linked a blob
.br
\-\ \fBfile_stat1.txt\fR       portable stat summary
.br
\-\ \fBfile_stat2.txt\fR       human stat summary
.br
\-\ \fBfile_types2.csv\fR      "blobname","mime\-type" (if enabled)
.br
\-\ \fBpar2_created.txt\fR     blobnames for which PAR2 was emitted
.br
\-\ \fBrecover.sh\fR           self\-contained recovery helper
.br
\-\ \fBcarb_starttime\fR       run timestamp
.br
\-\ \fBcarb_startfolder\fR     original PWD and normalized start dir
.br
\-\ \fBcarb_settings\fR        run settings (mode, par2 params, jobs, home)
.br
\fBblobs_meta/ingestedFolders.txt\fR  append\-only log of ingested roots
.SH RECOVERY
Per\-run \fBrecover.sh\fR requires: \fBCARB_RECOVER_TO_DIR\fR=\fI<destination>\fR
.PP
The recovery helper verifies and, if needed, repairs files using PAR2 when
parity exists; otherwise it copies bytes as\-is. Restores are performed
\fIrelative\fR to the snapshot root: files are recreated under
\fBCARB_RECOVER_TO_DIR\fR/\fI<basename_of_START_DIR>\fR/\fI<relative_path>\fR.
.PP
The footer includes a guard that exits cleanly when no files were recorded in
the snapshot. The script is robust to being invoked as \fB./recover.sh\fR or
via \fBbash recover.sh\fR.
.SH DEPENDENCIES
Required: \fBfind\fR, \fBxargs\fR, \fBawk\fR, \fBsed\fR, \fBtee\fR, \fBmktemp\fR, \fBln\fR, \fBcp\fR, \fBstat\fR, \fBdate\fR,
\fBopenssl\fR (or \fBshasum\fR).
.PP
Optional: \fBfile\fR (for MIME detection).
.PP
If PAR2 is enabled: \fBpar2cmdline\fR (\fBpar2create\fR/\fBpar2\fR).
.SH AUTO\-INSTALL
If allowed by flags below, missing tools are installed via a detected package
manager (\fBapt\fR, \fBdnf\fR, \fByum\fR, \fBpacman\fR, \fBzypper\fR, \fBapk\fR, \fBbrew\fR, \fBport\fR). You can disable
prompting or force "yes" via environment variables.
.SH ENVIRONMENT VARIABLES
.TP
\fBCARB_HOME\fR
Storage root for all carb data. Defaults:
.br
macOS: \fI$HOME/Library/Application Support/carb\fR
.br
Linux/*BSD: \fI${XDG_DATA_HOME:-$HOME/.local/share}/carb\fR
.TP
\fBCARB_JOBS\fR=\fI<n>\fR
Number of parallel workers (default: CPU cores).
.TP
\fBCARB_PAR2\fR=0|1
Enable/disable PAR2 creation (default 1).
.TP
\fBCARB_PAR2_REDUNDANCY\fR
Parity percent if fixed; else adaptive (default 10).
.TP
\fBCARB_PAR2_BLOCKSIZE\fR
Bytes or "auto"/empty for adaptive sizing (default: auto).
.TP
\fBCARB_PAR2_CMD\fR
PAR2 binary name to prefer (default: \fBpar2\fR; also tries \fBpar2create\fR).
.TP
\fBCARB_ENABLE_MIME\fR=0|1
MIME detection using \fBfile\fR (default 1).
.TP
\fBCARB_EXCLUDE_GLOBS\fR
Comma\-separated globs to prune during \fBfind\fR.
.TP
\fBCARB_TMPDIR\fR
Override temp directory path (defaults under \fBCARB_HOME\fR).
.TP
\fBCARB_AUTOINSTALL_ASK\fR
"1" to prompt (default), "0" to skip prompting.
.TP
\fBCARB_AUTOINSTALL_YES\fR
Non\-empty or "y" to auto\-yes install without prompting.
.TP
\fBCARB_PKG_MANAGER\fR
Force a package manager selection (e.g. \fBapt\fR, \fBbrew\fR).
.TP
\fBCARB_COMMENT\fR
Freeform note stored with run metadata.
.TP
\fBCARB_RECOVER_TO_DIR\fR
\fI(used only by recover.sh)\fR Destination root for restore.
.SH EXIT STATUS
0 on success; non\-zero on error. The generated \fBrecover.sh\fR exits 0 when
there are no files to restore.
.SH EXAMPLES
.IP
\fBcarb\fR /data
.br
\fBcarb\fR /data /var/backups/last.marker
.br
\fBCARB_EXCLUDE_GLOBS\fR=".git,node_modules" \fBcarb\fR ~/projects \-\-full
.br
# restore example (run from a specific metadata snapshot directory):
.br
\fBCARB_RECOVER_TO_DIR\fR=~/restore bash \fIblobs_meta/v05_YYYY\-MM\-DD_HH_MM_SS\fR/recover.sh
.SH SEE ALSO
par2(1), par2create(1), file(1), shasum(1), openssl(1), find(1)